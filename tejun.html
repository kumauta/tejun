<html>

<head>
  <meta charset="utf-8" />
  <style>
    .flex {
      display: flex;
      align-items: center;
      height: 20px;
    }

    .right {
      width: 80px;
    }

    .mid {
      width: calc(100% - 130px);
    }

    .mid_nfc {
      width: calc(100% - 130px);
      text-decoration: line-through;
    }

    .left {
      width: 50px;
    }

    .copy_btn {
      width: 70px;
    }
  </style>
  <link rel="stylesheet" href="./highlight/styles/default.min.css">
  <script src="./highlight/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
  <script>
    function copyToClipboard(idNo) {
      var copyTarget = document.getElementById("eId" + idNo);
      navigator.clipboard.writeText(copyTarget.innerText);
      copyTarget.style.backgroundColor = '#FFFF66';

      var now = new Date();
      var buttonText = ("0" + now.getHours()).slice(-2) + ":" + ("0" + now.getMinutes()).slice(-2) + ":" + ("0" + now.getSeconds()).slice(-2);
      document.getElementById("bId" + idNo).innerText = buttonText;
    }

    function convertProcess() {

      // clear
      document.getElementById("output_area").innerHTML = "";

      var process = document.getElementById("raw_process").value;
      var lines = process.split(/\r\n|\r|\n/);
      var pNo = 1;
      for (var i = 0; i < lines.length; i++) {
        if (lines[i] == '') {
          continue;
        }

        // escape html
        var line = lines[i];
        line = line.replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#39;');

        var convertedLine = "";
        if (line.indexOf('# ') == 0) {
          line = line.replace('# ', '');
          convertedLine = "<div style=\"color:red; font-size:14pt; font-weight: bold;\">" + line + "</div>";
        } else if (line.indexOf('## ') == 0) {
          line = line.replace('## ', '');
          convertedLine = "<div style=\"color:blue; font-size:10pt; font-weight: bold;\">" + line + "</div>";
        } else if (line.indexOf('$ ') == 0) {
          line = line.replace('$ ', '');
          convertedLine = "<div class=\"flex\">";
          convertedLine += "<div class=\"left\"><pre>" + ("0000" + pNo).slice(-4) + "&nbsp;</pre></div>";
          convertedLine += "<div class=\"mid\"><pre><code class=\"language-bash\" id=\"eId" + i + "\">" + line + "</code></pre></div>&nbsp;";
          convertedLine += "<div class=\"right\"><button class=\"copy_btn\" id=\"bId" + i + "\" onclick=\"copyToClipboard('" + i + "')\">Copy</div>";
          convertedLine += "</div>";
          pNo++;
        } else {
          convertedLine = "<div class=\"flex\">";
          convertedLine += "<div class=\"left\"><pre>" + ("0000" + pNo).slice(-4) + "&nbsp;</pre></div>";
          convertedLine += "<div class=\"mid_nfc\"><pre><code id=\"eId" + i + "\">" + line + "</code></pre></div>&nbsp;";
          convertedLine += "<div class=\"right\"></div>";
          convertedLine += "</div>";
          pNo++;
        }
        document.getElementById("output_area").innerHTML += convertedLine;
        hljs.highlightAll();
      }
    }

    // convert sample process
    window.onload = function () {
      convertProcess();
    }
  </script>

</head>

<body>
  <h2>手順のフォーマット</h2>
  <ul>
    <li><code style="background-color: rgb(192, 192, 192); font-weight: bold;"># </code> から開始される行はセクションのヘッダとして扱われる
    </li>
    <li><code style="background-color: rgb(192, 192, 192); font-weight: bold;">## </code> から開始される行はコメントとして扱われる</li>
    <li><code style="background-color: rgb(192, 192, 192); font-weight: bold;">$ </code> から開始される行は手順として扱われる</li>
    <li>上記以外はコピー対象外とする</li>
  </ul>
  <div id="input_area">
    <form>
      <h2>手順入力欄</h2>
      <textarea id="raw_process" name="raw_process" cols="147" rows="20" oninput="convertProcess()">
# animal
## dog
$ whoami
## cat
not covered</textarea>
      <br>
    </form>
  </div>
  <h2>変換後の手順</h2>
  <ul>
    <li>Copyボタンをクリックすると、クリップボードに手順がコピーされる</li>
  </ul>
  <div id="output_area">
  </div>
  <div style="text-align: right;">
    <br>
    <a href="https://github.com/kumauta/tejun">kumauta/tejun</a>
  </div>
</body>

</html>