<html>

<head>
  <meta charset="utf-8"/>
  <script>
    function copyToClipboard(idNo) {
      var copyTarget = document.getElementById("eId" + idNo);
      copyTarget.select();
      document.execCommand("Copy");
      copyTarget.style.backgroundColor = '#FFFF66';

      var now = new Date();
      var buttonText = ("0" + now.getHours()).slice(-2) + ":" + ("0" + now.getMinutes()).slice(-2) + ":" + ("0" + now.getSeconds()).slice(-2);
      document.getElementById("bId" + idNo).innerText=buttonText;
    }

    function convertProcess() {

      // clear
      document.getElementById("output_area").innerHTML = "";

      var process = document.getElementById("raw_process").value;
      var lines = process.split(/\r\n|\r|\n/);
      var pNo = 1;
      for (var i = 0; i < lines.length; i++) {
        if (lines[i] == '') {
          continue;
        }

        // escape html
        var line = lines[i];
        line = line.replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#39;');

        var convertedLine = "";
        if (line.indexOf('# ') == 0) {
          line = line.replace('# ','');
          convertedLine = "<div style=\"color:red; font-size:14pt; font-weight: bold;\">" + line + "</div>";
        } else if (line.indexOf('## ') == 0) {
          line = line.replace('## ','');
          convertedLine = "<div style=\"color:blue; font-size:10pt; font-weight: bold;\">" + line + "</div>";
        } else if (line.indexOf('$ ') == 0) {
          line = line.replace('$ ','');
          convertedLine = "<div>" + ("0000" + pNo).slice(-4) + "&nbsp;<input id=\"eId" + i + "\" size=\"150\" type=\"text\" value=\""
            + line + "\" readonly><button id=\"bId" + i + "\" onclick=\"copyToClipboard('" + i + "')\">Copy</div>";
          pNo ++;
        } else {
          convertedLine = "<div>" + ("0000" + pNo).slice(-4) + "&nbsp;<input id=\"eId" + i + "\" size=\"150\" type=\"text\" value=\""
            + line + "\" style=\"background-color: rgb(128, 128, 128);\" readonly></div>";
          pNo ++;
        }
        document.getElementById("output_area").innerHTML += convertedLine;
      }
    }
  </script>
</head>

<body>
  <div id="input_area">
    <h2>手順のフォーマット</h2>
    <ul>
      <li><code style="background-color: rgb(192, 192, 192); font-weight: bold;"># </code> から開始される行はセクションのヘッダとして扱われる</li>
      <li><code style="background-color: rgb(192, 192, 192); font-weight: bold;">## </code> から開始される行はコメントとして扱われる</li>
      <li><code style="background-color: rgb(192, 192, 192); font-weight: bold;">$ </code> から開始される行は手順として扱われる</li>
      <li>上記以外はコピー対象外とする</li>
    </ul>
    <form>
    <h2>手順入力欄</h2>
    <textarea id="raw_process" name="raw_process" cols="147" rows="20" oninput="convertProcess()">
# animal
## dog
$ whoami</textarea>
      <br>
    </form>
  </div>
  <h2>変換後の手順</h2>
  <ul>
    <li>Copyボタンをクリックすると、クリップボードに手順がコピーされる</li>
  </ul>
  <div id="output_area">
    <div style="color:red; font-size:14pt; font-weight: bold;">animal</div>
    <div style="color:blue; font-size:10pt; font-weight: bold;">dog</div>
    <div>0001&nbsp;<input id="eId0" size="150" type="text" value="whoami" readonly=""><button id="bId0" onclick="copyToClipboard('0')">Copy</button></div>
  </div>
  <div style="text-align: right;">
    <br>
    <a href="https://github.com/kumauta/tejun">kumauta/tejun</a>
  </div>
</body>

</html>
